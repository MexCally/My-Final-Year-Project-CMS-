<?php
session_start();
require_once '../config/db.php';

// Check if admin is logged in
if (!isset($_SESSION['admin_id'])) {
    header('Location: ../authentications/admin_login.html');
    exit();
}

// Get admin info from session
$admin_name = $_SESSION['admin_name'] ?? 'Admin';
$admin_email = $_SESSION['admin_email'] ?? '';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../assets/css/admin_dashboard.css" rel="stylesheet">
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-graduation-cap"></i> EduCMS</h3>
            </div>
            <ul class="list-unstyled components">
                <li>
                    <a href="admin_dashboard.php">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li>
                    <a href="admin_dashboard.php" data-section="students">
                        <i class="fas fa-user-graduate"></i> Students
                    </a>
                </li>
                <li>
                    <a href="admin_dashboard.php" data-section="courses">
                        <i class="fas fa-book"></i> Courses
                    </a>
                </li>
                <li>
                    <a href="admin_dashboard.php" data-section="lecturers">
                        <i class="fas fa-chalkboard-teacher"></i> Lecturers
                    </a>
                </li>
                <li>
                    <a href="admin_dashboard.php" data-section="grades">
                        <i class="fas fa-chart-line"></i> Grades
                    </a>
                </li>
                <li>
                    <a href="admin_dashboard.php" data-section="reports">
                        <i class="fas fa-file-alt"></i> Reports
                    </a>
                </li>
                <li>
                    <a href="admin_dashboard.php" data-section="registrations">
                        <i class="fas fa-clipboard-list"></i> Pending Registrations
                    </a>
                </li>
                <!-- <li class="active">
                    <a href="settings.php">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                </li> -->
            </ul>
        </nav>

        <!-- Page Content -->
        <div id="content" class="content">
            <!-- Top Navigation -->
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <i class="fas fa-align-left"></i>
                    </button>
                    <div class="ms-auto">
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user"></i> <?php echo htmlspecialchars($_SESSION['admin_name']); ?>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="admin_profile.php"><i class="fas fa-user-cog"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="settings.php"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="admin_logout.php"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Settings Section -->
            <div id="settings-section" class="section active">
                <div class="container-fluid">
                    <div class="row mb-4">
                        <div class="col">
                            <h2 class="text-primary">Settings</h2>
                            <p class="text-muted">Manage your profile, preferences, and account settings</p>
                        </div>
                    </div>

                    <!-- Settings Tabs -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="nav flex-column nav-pills" id="settings-tab" role="tablist">
                                        <button class="nav-link active" id="profile-tab-btn" onclick="window.location.href='admin_profile.php'" type="button">
                                            <i class="fas fa-user"></i> Profile
                                        </button>
                                        <button class="nav-link" id="password-tab-btn" data-settings-tab="password" type="button">
                                            <i class="fas fa-lock"></i> Password
                                        </button>
                                        <button class="nav-link" id="notifications-tab-btn" data-settings-tab="notifications" type="button">
                                            <i class="fas fa-bell"></i> Notifications
                                        </button>
                                        <button class="nav-link" id="system-tab-btn" data-settings-tab="system" type="button">
                                            <i class="fas fa-cogs"></i> System
                                        </button>
                                        <button class="nav-link" id="photo-tab-btn" data-bs-toggle="modal" data-bs-target="#uploadPhotoModal" type="button">
                                            <i class="fas fa-camera"></i> Photo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-9">
                            <!-- Profile Tab -->
                            <div class="settings-tab" id="profile-tab">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Profile Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="profileForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Full Name</label>
                                                    <input type="text" class="form-control" id="adminName" value="<?php echo htmlspecialchars($admin_name); ?>">
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Email</label>
                                                    <input type="email" class="form-control" id="adminEmail" value="<?php echo htmlspecialchars($admin_email); ?>">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Phone</label>
                                                    <input type="tel" class="form-control" id="adminPhone" placeholder="+1-555-0123">
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Department</label>
                                                    <input type="text" class="form-control" id="adminDepartment" placeholder="Administration">
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-primary" id="saveProfileBtn">Save Changes</button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Password Tab -->
                            <div class="settings-tab" id="password-tab" style="display: none;">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Change Password</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="passwordForm">
                                            <div class="mb-3">
                                                <label class="form-label">Current Password</label>
                                                <input type="password" class="form-control" id="currentPassword" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">New Password</label>
                                                <input type="password" class="form-control" id="newPassword" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Confirm New Password</label>
                                                <input type="password" class="form-control" id="confirmPassword" required>
                                            </div>
                                            <button type="button" class="btn btn-primary" id="changePasswordBtn">Change Password</button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Notifications Tab -->
                            <div class="settings-tab" id="notifications-tab" style="display: none;">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Notification Preferences</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="notificationsForm">
                                            <h6>Email Notifications</h6>
                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="emailNewStudents" checked>
                                                    <label class="form-check-label" for="emailNewStudents">
                                                        New student registrations
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="emailCourseUpdates" checked>
                                                    <label class="form-check-label" for="emailCourseUpdates">
                                                        Course updates and changes
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="emailGradeSubmissions" checked>
                                                    <label class="form-check-label" for="emailGradeSubmissions">
                                                        Grade submissions
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="emailSystemAlerts" checked>
                                                    <label class="form-check-label" for="emailSystemAlerts">
                                                        System alerts and maintenance
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="emailWeeklyReport">
                                                    <label class="form-check-label" for="emailWeeklyReport">
                                                        Weekly summary reports
                                                    </label>
                                                </div>
                                            </div>
                                            <h6>In-App Notifications</h6>
                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="inAppRegistrations" checked>
                                                    <label class="form-check-label" for="inAppRegistrations">
                                                        Student registrations
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="inAppGrades" checked>
                                                    <label class="form-check-label" for="inAppGrades">
                                                        Grade updates
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="inAppEnrollments" checked>
                                                    <label class="form-check-label" for="inAppEnrollments">
                                                        Course enrollments
                                                    </label>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-primary" id="saveNotificationsBtn">Save Preferences</button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- System Tab -->
                            <div class="settings-tab" id="system-tab" style="display: none;">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">System Preferences</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="systemForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Theme</label>
                                                    <select class="form-select" id="themeSelect">
                                                        <option value="light">Light</option>
                                                        <option value="dark">Dark</option>
                                                        <option value="auto">Auto</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Language</label>
                                                    <select class="form-select" id="languageSelect">
                                                        <option value="en">English</option>
                                                        <option value="es">Spanish</option>
                                                        <option value="fr">French</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Date Format</label>
                                                    <select class="form-select" id="dateFormatSelect">
                                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                        <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Items Per Page</label>
                                                    <input type="number" class="form-control" id="itemsPerPage" value="25" min="5" max="100">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="autoSaveToggle" checked>
                                                    <label class="form-check-label" for="autoSaveToggle">
                                                        Auto-save forms
                                                    </label>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-primary" id="saveSystemPrefsBtn">Save Preferences</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Photo Modal -->
    <div class="modal fade" id="uploadPhotoModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Profile Photo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Select Image</label>
                        <input type="file" class="form-control" id="photoInput" accept="image/*">
                    </div>
                    <div id="photoPreview" class="text-center mb-3">
                        <img src="/placeholder.svg?height=150&width=150" class="img-fluid rounded" alt="Preview">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="uploadPhotoBtn">Upload</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Settings tab functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('[data-settings-tab]');
            const settingsTabs = document.querySelectorAll('.settings-tab');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-settings-tab');

                    // Remove active class from all buttons
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');

                    // Hide all tabs
                    settingsTabs.forEach(tab => tab.style.display = 'none');
                    // Show selected tab
                    const selectedTab = document.getElementById(tabName + '-tab');
                    if (selectedTab) {
                        selectedTab.style.display = 'block';
                    }
                });
            });
        });
    </script>
</body>
</html>
